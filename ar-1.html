<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AFrame Test</title>

  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>

window.addEventListener('camera-init', (data) => {
        console.log('camera-init', data);
    })

    window.addEventListener('camera-error', (error) => {
        console.log('camera-error', error);
    })

        AFRAME.registerComponent('markerhandler',
          {
            init: function ()
            {

              this.el.sceneEl.addEventListener('markerFound', () =>
              {
                console.log("Marker Found");
                $(".prescreen").hide();
                // $('#cc_video').get(0).play();


              });

              this.el.sceneEl.addEventListener('markerLost', () =>
              {
                console.log("Marker Lost");
                $(".prescreen").show();
                // $('#cc_video').get(0).pause();
              });

            }
          });

        /**
         * What to do when video ends
         */
        function onEnd(event)
        {
          console.log("ENDED!!");
        }

        /**
         * Video pause event
         */
        function onPause(event)
        {
          console.log("PAUSE!!");

          // hide video and show poster
          var sceneEl = document.querySelector('a-scene');
          sceneEl.querySelector('#poster').object3D.visible = true;
          sceneEl.querySelector('#ccVideo').object3D.visible = false;
        }

        AFRAME.registerComponent('cursor-listener',
          {
            init: function ()
            {
              // init screens - hide video and show poster
              var sceneEl = document.querySelector('a-scene');
              sceneEl.querySelector('#poster').object3D.visible = true;
              sceneEl.querySelector('#ccVideo').object3D.visible = false;

              // set up events
              var videoEl = sceneEl.querySelector('#cc_video');
              videoEl.onended = onEnd;
              videoEl.onpause = onPause;

              // add click event handler
              this.el.addEventListener('click', function (evt)
              {
                console.log('I was clicked at: ', evt);
                var sceneEl = document.querySelector('a-scene');
                var posterImg = sceneEl.querySelector('#poster')
                console.log(sceneEl.querySelector('#poster'));
                console.log(sceneEl.querySelector('#ccVideo'));

                if (evt.srcElement.id == "ccVideo")
                {
                  var videoEl = sceneEl.querySelector('#cc_video');
                  if (!videoEl.paused)
                  {
                    // pause video
                    videoEl.pause();

                    // hide video and show poster 
                    sceneEl.querySelector('#poster').object3D.visible = true;
                    sceneEl.querySelector('#ccVideo').object3D.visible = false;
                  }
                  else
                  {
                    // show video hide poster
                    sceneEl.querySelector('#poster').object3D.visible = false;
                    sceneEl.querySelector('#ccVideo').object3D.visible = true;

                    // play video
                    videoEl.play();
                  }
                }
              });
            }
          });

  </script>
  <style>
    .threed {
      z-index: 0;
      height: 100%;
      width: 100%;
    }

    .overlay {
      z-index: 1;
    }

    .a-loader-title {
      color: rgb(153, 151, 151);
      background-color: black;
    }

    .prescreen {
      z-index: 2;
      display: flex;
      justify-content: center;
      height: 100%;
    }

    .prescreen img {
      margin: auto;
    }
  </style>
</head>

<body style='margin : 0px; overflow: hidden; width: 100%; height: 100%'>
  <div class="prescreen"><img src="assets/pre-screen.png"></div>
  <div class="threed">
    <a-scene vr-mode-ui="enabled: false" arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;" raycaster='near: 0; far: 50000' >
      <a-assets>
        <video id="cc_video" autostart="false" controls poster="assets/celebrate-students-poster.png" loop="false" src="assets/celebrate_students.mp4"></video>
        <img id="cc_video_poster" src="assets/celebrate-students-poster.png">
      </a-assets>

      <!-- <a-marker markerhandler preset="kanji" cursor="rayOrigin: mouse"> -->
      <a-marker markerhandler preset="hiro" cursor="rayOrigin: mouse">

        <a-video id="ccVideo" ccvideo position="0 0 0" rotation="-90 0 0" height="2" width="4" src="#cc_video" cursor-listener></a-video>
        <a-image id="poster" position="0 0 0" rotation="-90 0 0" height="2" width="4" src="#cc_video_poster"></a-image>

      </a-marker>
      <a-entity camera near="0.1" far="50000" fov="80">
      </a-entity>
    </a-scene>
  </div>

  <script>
  $(document).ready(function ()
  {


  });

  </script>
</body>

</html>